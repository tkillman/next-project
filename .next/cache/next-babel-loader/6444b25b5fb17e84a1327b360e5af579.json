{"ast":null,"code":"var _jsxFileName = \"C:\\\\next-project\\\\src\\\\utils\\\\withApollo.tsx\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport initApollo from \"./initApollo\";\nimport cookie from 'cookie';\nimport PropTypes from 'prop-types';\nimport isBrowser from \"./isBrowser\";\nimport Head from 'next/head';\n\nfunction parseCookies(req, options = {}) {\n  return cookie.parse(req ? req.headers.cookie || '' : document.cookie, options);\n}\n\nconst withApollo = App => {\n  var _class, _temp;\n\n  return _temp = _class = class WithData extends React.Component {\n    static async getInitialProps(ctx) {\n      const {\n        Component,\n        router,\n        ctx: {\n          req,\n          res\n        }\n      } = ctx;\n      const apollo = initApollo(router, {}, {\n        getToken: () => parseCookies(req).qid\n      });\n      ctx.ctx.apolloClient = apollo;\n      let appProps = {};\n\n      if (App.getInitialProps) {\n        appProps = await App.getInitialProps(ctx);\n      }\n\n      if (res && res.finished) {\n        // When redirecting, the response is finished.\n        // No point in continuing to render\n        return {};\n      }\n\n      if (!isBrowser) {\n        // Run all graphql queries in the component tree\n        // and extract the resulting data\n        // try {\n        // \t// Run all GraphQL queries\n        // \tawait getDataFromTree(\n        // \t\t<App\n        // \t\t\t{...appProps}\n        // \t\t\tComponent={Component}\n        // \t\t\trouter={router}\n        // \t\t\tapolloClient={apollo}\n        // \t\t/>\n        // \t);\n        // } catch (error) {\n        // \t// Prevent Apollo Client GraphQL errors from crashing SSR.\n        // \t// Handle them in components via the data.error prop:\n        // \t// https://www.apollographql.com/docs/react/api/react-apollo.html#graphql-query-data-error\n        // \tconsole.error('Error while running `getDataFromTree`', error);\n        // }\n        // getDataFromTree does not call componentWillUnmount\n        // head side effect therefore need to be cleared manually\n        Head.rewind();\n      } // Extract query data from the Apollo's store\n\n\n      const apolloState = apollo.cache.extract();\n      return _objectSpread(_objectSpread({}, appProps), {}, {\n        apolloState\n      });\n    }\n\n    constructor(props) {\n      super(props); // `getDataFromTree` renders the component first, the client is passed off as a property.\n      // After that rendering is done using Next's normal rendering pipeline\n\n      this.apolloClient = void 0;\n      this.apolloClient = initApollo(props.router, props.apolloState, {\n        getToken: () => {\n          return parseCookies().token;\n        }\n      });\n    }\n\n    render() {\n      return __jsx(App, _extends({}, this.props, {\n        apolloClient: this.apolloClient,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }\n      }));\n    }\n\n  }, _class.displayName = `WithData(${App.displayName})`, _class.propTypes = {\n    apolloState: PropTypes.object.isRequired\n  }, _temp;\n};\n\nexport default withApollo;","map":{"version":3,"sources":["C:/next-project/src/utils/withApollo.tsx"],"names":["React","initApollo","cookie","PropTypes","isBrowser","Head","parseCookies","req","options","parse","headers","document","withApollo","App","WithData","Component","getInitialProps","ctx","router","res","apollo","getToken","qid","apolloClient","appProps","finished","rewind","apolloState","cache","extract","constructor","props","token","render","displayName","propTypes","object","isRequired"],"mappings":";;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,OAAOC,UAAP;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,SAAP;AACA,OAAOC,IAAP,MAAiB,WAAjB;;AAEA,SAASC,YAAT,CAAsBC,GAAtB,EAAiCC,OAAO,GAAG,EAA3C,EAA+C;AAC9C,SAAON,MAAM,CAACO,KAAP,CAAaF,GAAG,GAAGA,GAAG,CAACG,OAAJ,CAAYR,MAAZ,IAAsB,EAAzB,GAA8BS,QAAQ,CAACT,MAAvD,EAA+DM,OAA/D,CAAP;AACA;;AAED,MAAMI,UAAU,GAAIC,GAAD,IAAc;AAAA;;AAE7B,0BAAO,MAAMC,QAAN,SAAuBd,KAAK,CAACe,SAA7B,CAAuC;AAMP,iBAAfC,eAAe,CAACC,GAAD,EAAW;AACnD,YAAM;AACLF,QAAAA,SADK;AAELG,QAAAA,MAFK;AAGLD,QAAAA,GAAG,EAAE;AAAEV,UAAAA,GAAF;AAAOY,UAAAA;AAAP;AAHA,UAIFF,GAJJ;AAKA,YAAMG,MAAM,GAAGnB,UAAU,CACxBiB,MADwB,EAExB,EAFwB,EAGxB;AACCG,QAAAA,QAAQ,EAAE,MAAMf,YAAY,CAACC,GAAD,CAAZ,CAAkBe;AADnC,OAHwB,CAAzB;AAQAL,MAAAA,GAAG,CAACA,GAAJ,CAAQM,YAAR,GAAuBH,MAAvB;AAEA,UAAII,QAAQ,GAAG,EAAf;;AACA,UAAIX,GAAG,CAACG,eAAR,EAAyB;AACxBQ,QAAAA,QAAQ,GAAG,MAAMX,GAAG,CAACG,eAAJ,CAAoBC,GAApB,CAAjB;AACA;;AAED,UAAIE,GAAG,IAAIA,GAAG,CAACM,QAAf,EAAyB;AACxB;AACA;AACA,eAAO,EAAP;AACA;;AAED,UAAI,CAACrB,SAAL,EAAgB;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACAC,QAAAA,IAAI,CAACqB,MAAL;AACA,OAlDkD,CAoDnD;;;AACA,YAAMC,WAAW,GAAGP,MAAM,CAACQ,KAAP,CAAaC,OAAb,EAApB;AAEA,6CACIL,QADJ;AAECG,QAAAA;AAFD;AAIM;;AAKDG,IAAAA,WAAW,CAACC,KAAD,EAAa;AAC7B,YAAMA,KAAN,EAD6B,CAG7B;AACA;;AAJ6B,WAFjBR,YAEiB;AAK7B,WAAKA,YAAL,GAAoBtB,UAAU,CAAC8B,KAAK,CAACb,MAAP,EAAea,KAAK,CAACJ,WAArB,EAAkC;AAC/DN,QAAAA,QAAQ,EAAE,MAAM;AACf,iBAAOf,YAAY,GAAG0B,KAAtB;AACA;AAH8D,OAAlC,CAA9B;AAKA;;AAEMC,IAAAA,MAAM,GAAG;AACf,aAAO,MAAC,GAAD,eAAS,KAAKF,KAAd;AAAqB,QAAA,YAAY,EAAE,KAAKR,YAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAP;AACA;;AApF+C,GAA9C,SACkBW,WADlB,GACiC,YAAWrB,GAAG,CAACqB,WAAY,GAD5D,SAEkBC,SAFlB,GAE8B;AAC/BR,IAAAA,WAAW,EAAExB,SAAS,CAACiC,MAAV,CAAiBC;AADC,GAF9B;AAsFH,CAxFD;;AA0FA,eAAezB,UAAf","sourcesContent":["import React from 'react';\r\nimport { ApolloClient, NormalizedCacheObject } from '@apollo/client';\r\nimport initApollo from './initApollo';\r\nimport cookie from 'cookie';\r\nimport PropTypes from 'prop-types';\r\nimport isBrowser from '~/utils/isBrowser';\r\nimport Head from 'next/head';\r\n\r\nfunction parseCookies(req?: any, options = {}) {\r\n\treturn cookie.parse(req ? req.headers.cookie || '' : document.cookie, options);\r\n}\r\n\r\nconst withApollo = (App: any) => {\r\n\r\n    return class WithData extends React.Component {\r\n        public static displayName = `WithData(${App.displayName})`;\r\n        public static propTypes = {\r\n\t\t\tapolloState: PropTypes.object.isRequired\r\n\t\t};\r\n\r\n        public static async getInitialProps(ctx: any) {\r\n\t\t\tconst {\r\n\t\t\t\tComponent,\r\n\t\t\t\trouter,\r\n\t\t\t\tctx: { req, res }\r\n\t\t\t} = ctx;\r\n\t\t\tconst apollo = initApollo(\r\n\t\t\t\trouter,\r\n\t\t\t\t{},\r\n\t\t\t\t{\r\n\t\t\t\t\tgetToken: () => parseCookies(req).qid\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tctx.ctx.apolloClient = apollo;\r\n\r\n\t\t\tlet appProps = {};\r\n\t\t\tif (App.getInitialProps) {\r\n\t\t\t\tappProps = await App.getInitialProps(ctx);\r\n\t\t\t}\r\n\r\n\t\t\tif (res && res.finished) {\r\n\t\t\t\t// When redirecting, the response is finished.\r\n\t\t\t\t// No point in continuing to render\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\r\n\t\t\tif (!isBrowser) {\r\n\t\t\t\t// Run all graphql queries in the component tree\r\n\t\t\t\t// and extract the resulting data\r\n\t\t\t\t// try {\r\n\t\t\t\t// \t// Run all GraphQL queries\r\n\t\t\t\t// \tawait getDataFromTree(\r\n\t\t\t\t// \t\t<App\r\n\t\t\t\t// \t\t\t{...appProps}\r\n\t\t\t\t// \t\t\tComponent={Component}\r\n\t\t\t\t// \t\t\trouter={router}\r\n\t\t\t\t// \t\t\tapolloClient={apollo}\r\n\t\t\t\t// \t\t/>\r\n\t\t\t\t// \t);\r\n\t\t\t\t// } catch (error) {\r\n\t\t\t\t// \t// Prevent Apollo Client GraphQL errors from crashing SSR.\r\n\t\t\t\t// \t// Handle them in components via the data.error prop:\r\n\t\t\t\t// \t// https://www.apollographql.com/docs/react/api/react-apollo.html#graphql-query-data-error\r\n\t\t\t\t// \tconsole.error('Error while running `getDataFromTree`', error);\r\n\t\t\t\t// }\r\n\r\n\t\t\t\t// getDataFromTree does not call componentWillUnmount\r\n\t\t\t\t// head side effect therefore need to be cleared manually\r\n\t\t\t\tHead.rewind();\r\n\t\t\t}\r\n\r\n\t\t\t// Extract query data from the Apollo's store\r\n\t\t\tconst apolloState = apollo.cache.extract();\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...appProps,\r\n\t\t\t\tapolloState\r\n\t\t\t};\r\n        }\r\n        \r\n\r\n        public apolloClient: ApolloClient<NormalizedCacheObject>;\r\n\r\n        constructor(props: any) {\r\n\t\t\tsuper(props);\r\n\r\n\t\t\t// `getDataFromTree` renders the component first, the client is passed off as a property.\r\n\t\t\t// After that rendering is done using Next's normal rendering pipeline\r\n\t\t\tthis.apolloClient = initApollo(props.router, props.apolloState, {\r\n\t\t\t\tgetToken: () => {\r\n\t\t\t\t\treturn parseCookies().token;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tpublic render() {\r\n\t\t\treturn <App {...this.props} apolloClient={this.apolloClient} />;\r\n\t\t}\r\n    }    \r\n}\r\n\r\nexport default withApollo;"]},"metadata":{},"sourceType":"module"}