{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { ApolloClient, InMemoryCache, ApolloLink, createHttpLink } from '@apollo/client';\nimport isBrowser from \"./isBrowser\";\nimport { setContext } from \"@apollo/client/link/context\";\nimport { onError } from \"@apollo/client/link/error\";\nlet apolloClient = null;\nconst isDev = true;\n\nconst create = (router, initialState, {\n  getToken\n}) => {\n  console.log('create init'); // Apollo GraphQL 서버 URL 세팅\n\n  const httpLink = createHttpLink({\n    uri: process.env.API_SERVER_URL,\n    credentials: 'include' // 종류: omit(생략), include(다른 도메인일 경우), same-origin(같은 도메인일 경우)\n    // credentials: 'same-origin'\n\n  });\n  const authLink = setContext((req, {\n    headers\n  }) => {\n    const token = getToken();\n    return {\n      headers: _objectSpread(_objectSpread({}, headers), {}, {\n        cookie: token ? `qid=${token}` : '' // authorization: token ? `Bearer ${token}` : ''\n\n      })\n    };\n  });\n  const errorLink = onError(({\n    response,\n    graphQLErrors,\n    networkError,\n    operation,\n    forward\n  }) => {\n    if (graphQLErrors) {\n      console.log('graphQLErrors');\n    }\n  });\n  let apolloLink = [errorLink, authLink, httpLink];\n  return new ApolloClient({\n    connectToDevTools: isBrowser,\n    ssrMode: !isBrowser,\n    // Disables forceFetch on the server (so queries are only run once)\n    link: ApolloLink.from(apolloLink),\n    cache: new InMemoryCache().restore(initialState || {})\n  });\n};\n\nconst initApollo = (router, initialState, options) => {\n  // Make sure to create a new client for every server-side request so that data\n  // isn't shared between connections (which would be bad)\n  if (!isBrowser) {\n    return create(router, initialState, options);\n  } // Reuse client on the client-side\n\n\n  if (!apolloClient) {\n    apolloClient = create(router, initialState, options);\n  }\n\n  return apolloClient;\n};\n\nexport default initApollo;","map":{"version":3,"sources":["C:/next-project/src/utils/initApollo.ts"],"names":["ApolloClient","InMemoryCache","ApolloLink","createHttpLink","isBrowser","setContext","onError","apolloClient","isDev","create","router","initialState","getToken","console","log","httpLink","uri","process","env","API_SERVER_URL","credentials","authLink","req","headers","token","cookie","errorLink","response","graphQLErrors","networkError","operation","forward","apolloLink","connectToDevTools","ssrMode","link","from","cache","restore","initApollo","options"],"mappings":";;;;;;AACA,SACCA,YADD,EAECC,aAFD,EAICC,UAJD,EAKCC,cALD,QAMO,gBANP;AAQA,OAAOC,SAAP;AACA,SAASC,UAAT,QAA2B,6BAA3B;AACA,SAASC,OAAT,QAAwB,2BAAxB;AAMA,IAAIC,YAAwD,GAAG,IAA/D;AACA,MAAMC,KAAK,OAAX;;AAEA,MAAMC,MAAM,GAAG,CAACC,MAAD,EAAiBC,YAAjB,EAAoC;AAAEC,EAAAA;AAAF,CAApC,KAA+D;AAC1EC,EAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ,EAD0E,CAEzE;;AACJ,QAAMC,QAAQ,GAAGZ,cAAc,CAAC;AAC/Ba,IAAAA,GAAG,EAAEC,OAAO,CAACC,GAAR,CAAYC,cADc;AAE/BC,IAAAA,WAAW,EAAE,SAFkB,CAG/B;AACA;;AAJ+B,GAAD,CAA/B;AAOG,QAAMC,QAAQ,GAAGhB,UAAU,CAAC,CAACiB,GAAD,EAAM;AAAEC,IAAAA;AAAF,GAAN,KAAsB;AAC9C,UAAMC,KAAK,GAAGZ,QAAQ,EAAtB;AACA,WAAO;AACHW,MAAAA,OAAO,kCACAA,OADA;AAEHE,QAAAA,MAAM,EAAED,KAAK,GAAI,OAAMA,KAAM,EAAhB,GAAoB,EAF9B,CAGH;;AAHG;AADJ,KAAP;AAOH,GAT0B,CAA3B;AAWC,QAAME,SAAS,GAAGpB,OAAO,CAC5B,CAAC;AAAEqB,IAAAA,QAAF;AAAYC,IAAAA,aAAZ;AAA2BC,IAAAA,YAA3B;AAAyCC,IAAAA,SAAzC;AAAoDC,IAAAA;AAApD,GAAD,KAAmE;AACzD,QAAIH,aAAJ,EAAmB;AACff,MAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACH;AACR,GALyB,CAAzB;AAOD,MAAIkB,UAAU,GAAG,CAACN,SAAD,EAAYL,QAAZ,EAAsBN,QAAtB,CAAjB;AAEA,SAAO,IAAIf,YAAJ,CAAiB;AAC1BiC,IAAAA,iBAAiB,EAAE7B,SADO;AAE1B8B,IAAAA,OAAO,EAAE,CAAC9B,SAFgB;AAEL;AACrB+B,IAAAA,IAAI,EAAEjC,UAAU,CAACkC,IAAX,CAAgBJ,UAAhB,CAHoB;AAI1BK,IAAAA,KAAK,EAAE,IAAIpC,aAAJ,GAAoBqC,OAApB,CAA4B3B,YAAY,IAAI,EAA5C;AAJmB,GAAjB,CAAP;AAMH,CApCD;;AAwCA,MAAM4B,UAAU,GAAG,CAClB7B,MADkB,EAElBC,YAFkB,EAGlB6B,OAHkB,KAId;AACJ;AACA;AACA,MAAI,CAACpC,SAAL,EAAgB;AACf,WAAOK,MAAM,CAACC,MAAD,EAASC,YAAT,EAAuB6B,OAAvB,CAAb;AACA,GALG,CAOJ;;;AACA,MAAI,CAACjC,YAAL,EAAmB;AAClBA,IAAAA,YAAY,GAAGE,MAAM,CAACC,MAAD,EAASC,YAAT,EAAuB6B,OAAvB,CAArB;AACA;;AAED,SAAOjC,YAAP;AACA,CAjBD;;AAmBA,eAAegC,UAAf","sourcesContent":["\r\nimport {\r\n\tApolloClient,\r\n\tInMemoryCache,\r\n\tNormalizedCacheObject,\r\n\tApolloLink,\r\n\tcreateHttpLink\r\n} from '@apollo/client'\r\nimport { Router } from 'next/router';\r\nimport isBrowser from './isBrowser';\r\nimport { setContext } from \"@apollo/client/link/context\";\r\nimport { onError } from \"@apollo/client/link/error\";\r\n\r\ninterface IOptions {\r\n\tgetToken: () => string;\r\n}\r\n\r\nlet apolloClient: ApolloClient<NormalizedCacheObject> | null = null;\r\nconst isDev = process.env.NODE_ENV === 'development';\r\n\r\nconst create = (router: Router, initialState: any, { getToken }: IOptions) => {\r\n    console.log('create init');\r\n    \t// Apollo GraphQL 서버 URL 세팅\r\n\tconst httpLink = createHttpLink({\r\n\t\turi: process.env.API_SERVER_URL,\r\n\t\tcredentials: 'include'\r\n\t\t// 종류: omit(생략), include(다른 도메인일 경우), same-origin(같은 도메인일 경우)\r\n\t\t// credentials: 'same-origin'\r\n\t});\r\n\r\n    const authLink = setContext((req, { headers }) => {\r\n        const token = getToken();\r\n        return {\r\n            headers: {\r\n                ...headers,\r\n                cookie: token ? `qid=${token}` : ''\r\n                // authorization: token ? `Bearer ${token}` : ''\r\n            }\r\n        };\r\n    });\r\n\r\n     const errorLink = onError(\r\n\t\t({ response, graphQLErrors, networkError, operation, forward }) => {\r\n            if (graphQLErrors) {\r\n                console.log('graphQLErrors');\r\n            }\r\n    });\r\n\r\n    let apolloLink = [errorLink, authLink, httpLink] as ApolloLink[];\r\n\r\n    return new ApolloClient({\r\n\t\tconnectToDevTools: isBrowser,\r\n\t\tssrMode: !isBrowser, // Disables forceFetch on the server (so queries are only run once)\r\n\t\tlink: ApolloLink.from(apolloLink),\r\n\t\tcache: new InMemoryCache().restore(initialState || {})\r\n\t});\r\n}    \r\n\r\n\r\n\r\nconst initApollo = (\r\n\trouter: Router,\r\n\tinitialState: any,\r\n\toptions: IOptions\r\n) => {\r\n\t// Make sure to create a new client for every server-side request so that data\r\n\t// isn't shared between connections (which would be bad)\r\n\tif (!isBrowser) {\r\n\t\treturn create(router, initialState, options);\r\n\t}\r\n\r\n\t// Reuse client on the client-side\r\n\tif (!apolloClient) {\r\n\t\tapolloClient = create(router, initialState, options);\r\n\t}\r\n\r\n\treturn apolloClient;\r\n};\r\n\r\nexport default initApollo;"]},"metadata":{},"sourceType":"module"}